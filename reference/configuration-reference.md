# Configuration Reference

Configuration options for VMStation components.

## Inventory Configuration

File: `ansible/inventory/hosts.yml`

### Global Variables

```yaml
all:
  vars:
    kubernetes_version: "1.29"
    pod_network_cidr: "10.244.0.0/16"
    service_network_cidr: "10.96.0.0/12"
    control_plane_endpoint: "192.168.4.63:6443"
    cni_plugin: flannel
```

### Node Configuration

```yaml
monitoring_nodes:
  hosts:
    masternode:
      ansible_host: 192.168.4.63
      ansible_connection: local

storage_nodes:
  hosts:
    storagenodet3500:
      ansible_host: 192.168.4.61
      ansible_user: root
      ansible_ssh_private_key_file: /root/.ssh/id_k3s
      mac_address: "b8:ac:6f:7e:6c:9d"
```

## Prometheus Configuration

File: `manifests/monitoring/prometheus.yaml`

### Retention

```yaml
args:
  - '--storage.tsdb.retention.time=15d'
  - '--storage.tsdb.retention.size=8GB'
```

### SecurityContext

```yaml
securityContext:
  runAsUser: 65534
  runAsGroup: 65534
  fsGroup: 65534
```

### Scrape Interval

```yaml
global:
  scrape_interval: 15s
  evaluation_interval: 15s
```

## Loki Configuration

File: `manifests/monitoring/loki.yaml`

### Schema

```yaml
schema_config:
  configs:
    - from: 2020-01-01
      store: boltdb-shipper
      object_store: filesystem
      schema: v11
      index:
        prefix: loki_index_
        period: 24h
```

### Retention

```yaml
limits_config:
  retention_period: 744h
```

### Storage

```yaml
storage_config:
  boltdb_shipper:
    active_index_directory: /loki/index
    cache_location: /loki/cache
  filesystem:
    directory: /loki/chunks
```

## Grafana Configuration

File: `manifests/monitoring/grafana.yaml`

### Authentication

```ini
[auth.anonymous]
enabled = true
org_role = Viewer

[auth]
disable_login_form = false
```

### Datasources

```yaml
datasources:
  - name: Prometheus
    type: prometheus
    url: http://prometheus:9090
    isDefault: true
  - name: Loki
    type: loki
    url: http://loki:3100
```

## Auto-Sleep Configuration

File: Auto-generated by `./deploy.sh setup`

### Idle Threshold

Default: 2 hours

### Check Interval

Default: 15 minutes

## Storage Configuration

### Storage Class

```yaml
apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: local-path
provisioner: rancher.io/local-path
volumeBindingMode: WaitForFirstConsumer
reclaimPolicy: Retain
```

### Base Path

Default: `/srv/monitoring_data/`

## Kubespray Configuration

File: `.cache/kubespray/inventory/mycluster/group_vars/k8s_cluster/k8s-cluster.yml`

### Kubernetes Version

```yaml
kube_version: v1.29.6
```

### CNI

```yaml
kube_network_plugin: calico
```

### Container Runtime

```yaml
container_manager: containerd
```

## Related Documentation

- [Installation](../getting-started/installation.md)
- [Architecture](../architecture/overview.md)
